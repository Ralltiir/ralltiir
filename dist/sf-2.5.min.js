define("sfr/router/lang/extend",["require"],function(){function t(t,r){for(var e=1,n=arguments.length;n>e;e++)if(r=arguments[e])for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o]);return t}return t}),define("sfr/router/lang/inherits",["require"],function(){function t(t,r){var e=function(){};e.prototype=r.prototype;var n=t.prototype,o=t.prototype=new e;for(var i in n)n.hasOwnProperty(i)&&(o[i]=n[i]);return t.prototype.constructor=t,t}return t}),define("sfr/router/emitter",["require"],function(){function t(){}var r=t.prototype;
r._getEvents=function(){return this._events||(this._events={}),this._events},r._getMaxListeners=function(){return isNaN(this.maxListeners)&&(this.maxListeners=10),this.maxListeners},r.on=function(t,r){var e=this._getEvents(),n=this._getMaxListeners();e[t]=e[t]||[];var o=e[t].length;if(o>=n&&0!==n)throw new RangeError("Warning: possible Emitter memory leak detected. "+o+" listeners added.");return e[t].push(r),this},r.once=function(t,r){function e(){n.off(t,e),r.apply(this,arguments)}var n=this;return e.listener=r,this.on(t,e),this
},r.off=function(t,r){var e=this._getEvents();if(0===arguments.length)return this._events={},this;var n=e[t];if(!n)return this;if(1===arguments.length)return delete e[t],this;for(var o,i=0;i<n.length;i++)if(o=n[i],o===r||o.listener===r){n.splice(i,1);break}return this},r.emit=function(t){for(var r=this._getEvents(),e=r[t],n=[],o=1;o<arguments.length;o++)n.push(arguments[o]);if(e)for(e=e.slice(0),o=0;o<e.length;o++)e[o].apply(this,n);return this},r.listeners=function(t){var r=this._getEvents();return r[t]||[]
},r.setMaxListeners=function(t){return this.maxListeners=t,this};var e=Object.keys(r);return t.mixin=function(t){for(var n,o=0,i=e.length;i>o;o++)n=e[o],t[n]=r[n];return t},t}),define("sfr/router/router/URL",["require","sfr/router/uri/component/Path","sfr/router/uri/component/Query","sfr/router/uri/component/Fragment","sfr/router/router/config"],function(t){function r(t,r){r=r||{},t=(t||"").trim()||i.path;var s=this.token=r.token||u,a=r.root||i.root;"/"===a.charAt(a.length-1)&&(a=a.substring(0,a.length-1)),this.root=a,t=t.split("#"),this.fragment=new o(t[1]),t=t[0].split(s);
var f=r.base||{};this.path=new e(t[0],f.path),this.query=new n(t[1]);var c=this.path.get();this.outRoot=0===c.indexOf(".."),this.outRoot&&(c=e.resolve(a+"/",c),0===c.indexOf(a)&&(c=c.substring(a.length),this.path.set(c),this.outRoot=!1)),this.outRoot||"/"===c.charAt(0)||this.path.set("/"+c),r.query&&this.query.add(r.query)}var e=t("sfr/router/uri/component/Path"),n=t("sfr/router/uri/component/Query"),o=t("sfr/router/uri/component/Fragment"),i=t("sfr/router/router/config"),u="?";return r.prototype.toString=function(){var t=this.root,r=this.path.get();
return r=this.outRoot?e.resolve(t+"/",r):t+r,r+this.query.toString(this.token)+this.fragment.toString()},r.prototype.equalPath=function(t){return this.path.get()===t},r.prototype.equal=function(t){return this.query.equal(t.query)&&this.equalPath(t.path.get())},r.prototype.equalWithFragment=function(t){return this.equal(t)&&this.fragment.equal(t.fragment)},r.prototype.getQuery=function(){return this.query.get()},r.prototype.getPath=function(){return this.path.get()},r}),define("sfr/router/router/config",[],{path:"/",root:"",mode:"async"}),define("sfr/router/router/controller",["require","sfr/router/lang/extend","sfr/router/router/URL","sfr/router/router/config"],function(t){function r(t,r){e(t,r)||(s(t,r),a=t)
}function e(t,r){return a&&t.equal(a)&&!r.force}function n(t){var r=p.root;if("/"===t.charAt(0)&&r)if(0===t.indexOf(r))t=t.replace(r,"");else{var e=r.split("/").slice(1);e=e.map(function(){return".."}),t=e.join("/")+t,a=null}return t}function o(t,r){return t||(t=n(location.pathname)),new c(t,{query:r,base:a})}function i(t,e){t=t||{};var i=n(location.pathname);if(location.search.length>1&&(i+=location.search),i=o(i),i.outRoot)return u(i.toString(),!0);var s=e?{src:"sync"}:f({src:"history"},t.state);
r(i,s)}function u(t,r){h.dispose(),r?location.replace(t):location.href=t}var s,a,f=t("sfr/router/lang/extend"),c=t("sfr/router/router/URL"),p=t("sfr/router/router/config"),h={};return h.init=function(t){window.addEventListener("popstate",i,!1),s=t,i(null,!0)},h.redirect=function(t,n,i){return i=i||{},t=o(t,n),t.outRoot||"page"===p.mode?!e(t,i)&&u(t.toString()):(a.equalWithFragment(t)||i.silent||history.pushState(i,i.title,t.toString()),void r(t,i))},h.reset=function(t,n,i){return i=i||{},t=o(t,n),t.outRoot||"page"===p.mode?!e(t,i)&&u(t.toString()):(i.silent?a=t:r(t,i),void history.replaceState(i,i.title,t.toString()))
},h.dispose=function(){window.removeEventListener("popstate",i,!1),a=null},h}),define("sfr/router/router",["require","sfr/router/lang/extend","sfr/router/router/config","sfr/router/router/controller"],function(t){function r(t){var r=-1;return t=t.toString(),p.some(function(e,n){return e.raw.toString()===t&&(r=n),-1!==r}),r}function e(t,r){for(var e,n={},o=r.params||[],i=t.match(r.path)||[],u=1;u<i.length;u++)e=o[u-1]||"$"+u,n[e]=decodeURIComponent(i[u]);return n}function n(t,r){function o(){if(l=!1,u){var t=s({},u);
u=null,n(t.url,t.options)}}if(r=r||{},l)return void(u={url:t,options:r});l=!0;var i,a,f=s({},t.getQuery()),c={},d=t.getPath();if(p.some(function(r){return r.path instanceof RegExp?r.path.test(d)&&(i=r,c=e(d,r)):t.equalPath(r.path)&&(i=r),r.path||(a=r),!!i}),i=i||a,!i)throw u=null,l=!1,new Error("can not found route for: "+d);r.title&&(document.title=r.title);var g={path:d,pathPattern:i.raw,query:f,params:c,url:t.toString(),options:r},m=[g,h];h=g,i.fn.length>m.length?(m.push(o),i.fn.apply(i.thisArg,m)):(i.fn.apply(i.thisArg,m),o())
}function o(t){var r={params:[]};return r.path=t.replace(/:([^\/]+)/g,function(t,e){return r.params.push(e),"([^/]+)"}),r.path=new RegExp("^"+r.path+"$"),r}function i(t,r,e){var n={raw:t,path:t,fn:r,thisArg:e};!(t instanceof RegExp)&&t.indexOf(":")>=0&&(n=s(n,o(t))),p.push(n)}var u,s=t("sfr/router/lang/extend"),a=t("sfr/router/router/config"),f=t("sfr/router/router/controller"),c={},p=[],h={},l=!1;return c.reset=function(t,r,e){f.reset(t,r,e)},c.config=function(t){t=t||{};var r=t.root;r&&"/"===r.charAt(r.length-1)&&(r=t.root=r.substring(0,r.length-1)),r&&"/"!==r.charAt(0)&&(t.root="/"+r),s(a,t)
},c.add=function(t,e,n){if(r(t)>=0)throw new Error("path already exist");i(t,e,n)},c.remove=function(t){var e=r(t);e>=0&&p.splice(e,1)},c.exist=function(t){return r(t)>=0},c.clear=function(){p=[]},c.redirect=function(t,r,e){f.redirect(t,r,e)},c.start=function(t){c.config(t),f.init(n)},c.stop=function(){f.dispose(),c.clear(),u=null,h={}},c.controller=function(t){f=t},c}),define("sfr/router/uri",["require","sfr/router/uri/URI","sfr/router/uri/util/uri-parser","sfr/router/uri/component/Path"],function(t){var r=t("sfr/router/uri/URI"),e=function(t){return new r(t)
};return e.parse=t("sfr/router/uri/util/uri-parser"),e.resolve=t("sfr/router/uri/component/Path").resolve,e}),define("sfr/router/uri/URI",["require","sfr/router/uri/util/uri-parser","sfr/router/uri/component/Scheme","sfr/router/uri/component/UserName","sfr/router/uri/component/Password","sfr/router/uri/component/Host","sfr/router/uri/component/Port","sfr/router/uri/component/Path","sfr/router/uri/component/Query","sfr/router/uri/component/Fragment"],function(t){function r(t){t=n(t);var r,e=this;Object.keys(o).forEach(function(n){r=o[n],e[n]=new r(t[n])
})}function e(t){var r=[],e=t.username.toString(),n=t.password.toString(),o=t.host.toString(),i=t.port.toString();return(e||n)&&r.push(e+":"+n+"@"),r.push(o),r.push(i),r.join("")}var n=t("sfr/router/uri/util/uri-parser"),o={scheme:t("sfr/router/uri/component/Scheme"),username:t("sfr/router/uri/component/UserName"),password:t("sfr/router/uri/component/Password"),host:t("sfr/router/uri/component/Host"),port:t("sfr/router/uri/component/Port"),path:t("sfr/router/uri/component/Path"),query:t("sfr/router/uri/component/Query"),fragment:t("sfr/router/uri/component/Fragment")};
return r.prototype.set=function(){var t=0,r={};arguments.length>1&&(r.name=arguments[t++]),r.data=Array.prototype.slice.call(arguments,t);var e=this[r.name];if(e)e.set.apply(e,r.data);else{var i=this,u=n(r.data[0]);Object.keys(o).forEach(function(t){i[t].set(u[t])})}},r.prototype.get=function(){var t={name:arguments[0],data:Array.prototype.slice.call(arguments,1)},r=this[t.name];return r?r.get.apply(r,t.data):void 0},r.prototype.toString=function(t){var r,n=this[t];if(n)r=n.toString();else{r=[];var o=this.scheme.toString();
o&&r.push(o+":");var i=e(this);o&&i&&r.push("//"),r.push(i),r.push(this.path.toString()),r.push(this.query.toString()),r.push(this.fragment.toString()),r=r.join("")}return r},r.prototype.equal=function(t){t instanceof r||(t=new r(t));for(var e,n=!0,i=Object.keys(o),u=0;n&&(e=i[u]);u++)n="port"===e?this[e].equal(t[e].get(),this.scheme.get()):this[e].equal(t[e]);return n},r}),define("sfr/router/uri/component/Abstract",["require"],function(){function t(){var t=Array.prototype.slice.call(arguments);this.set.apply(this,t)
}return t.prototype.get=function(){return this.data},t.prototype.set=function(t){this.data=t||""},t.prototype.add=function(t){this.set(t)},t.prototype.remove=function(){this.data=""},t.prototype.toString=function(){return this.data.toString()},t.prototype.equal=function(r){return r instanceof t&&(r=r.get()),this.data==r},t}),define("sfr/router/uri/component/Fragment",["require","sfr/router/lang/inherits","sfr/router/uri/component/Abstract"],function(t){function r(t){n.call(this,t)}var e=t("sfr/router/lang/inherits"),n=t("sfr/router/uri/component/Abstract"),o="#";
return e(r,n),r.prototype.toString=function(t){return t=t||o,this.data?t+this.data:""},r}),define("sfr/router/uri/component/Host",["require","sfr/router/lang/inherits","sfr/router/uri/component/Abstract"],function(t){function r(t){n.call(this,t)}var e=t("sfr/router/lang/inherits"),n=t("sfr/router/uri/component/Abstract");return e(r,n),r.prototype.set=function(t){t=t||"",this.data=t.toLowerCase()},r.prototype.equal=function(t){return t=t instanceof r?t.get():t||"",this.data===t.toLowerCase()},r}),define("sfr/router/uri/component/Password",["require","sfr/router/lang/inherits","sfr/router/uri/component/Abstract"],function(t){function r(t){n.call(this,t)
}var e=t("sfr/router/lang/inherits"),n=t("sfr/router/uri/component/Abstract");return e(r,n),r}),define("sfr/router/uri/component/Path",["require","sfr/router/lang/inherits","sfr/router/uri/component/Abstract"],function(t){function r(t){return t||(t="/"),t}function e(t){return t=t.split("/"),t.pop(),t.join("/")}function n(t,r){for(var e,n=0,o=t.length-1;e=t[o];o--)"."===e?t.splice(o,1):".."===e?(t.splice(o,1),n++):n&&(t.splice(o,1),n--);if(r)for(;n-->0;)t.unshift("..");return t}function o(t,r){u.call(this,t,r)
}var i=t("sfr/router/lang/inherits"),u=t("sfr/router/uri/component/Abstract");return o.resolve=function(t,r){if(r=r||"","/"===r.charAt(0))return o.resolve(r);var i="/"===t.charAt(0),u=!1;r?(t=e(t),u="/"===r.charAt(r.length-1)):t.length>1&&(u="/"===t.charAt(t.length-1));var s=t.split("/").concat(r.split("/")).filter(function(t){return!!t});return s=n(s,!i),(i?"/":"")+(s.length>0?s.join("/")+(u?"/":""):"")},i(o,u),o.prototype.set=function(t,r){r instanceof o&&(r=r.get());var e=[t||""];r&&e.unshift(r),this.data=o.resolve.apply(o,e)
},o.prototype.equal=function(t){var e=r(this.data);return t=r(t instanceof o?t.get():o.resolve(t||"")),e===t},o.prototype.resolve=function(t,r){t instanceof o&&(t=t.get());var e=[this.data];r?e.unshift(t):e.push(t),this.data=o.resolve.apply(o,e)},o}),define("sfr/router/uri/component/Port",["require","sfr/router/lang/inherits","sfr/router/uri/component/Abstract"],function(t){function r(t){n.call(this,t)}var e=t("sfr/router/lang/inherits"),n=t("sfr/router/uri/component/Abstract"),o={ftp:"21",ssh:"22",telnet:"23",http:"80",https:"443",ws:"80",wss:"443"};
return e(r,n),r.prototype.equal=function(t,e){var n=this.data||o[e];return t instanceof r&&(t=t.get()),t=t||o[e],n===t},r.prototype.toString=function(){return this.data?":"+this.data:""},r}),define("sfr/router/uri/component/Query",["require","sfr/router/lang/inherits","sfr/router/lang/extend","sfr/router/uri/component/Abstract","sfr/router/uri/util/parse-query","sfr/router/uri/util/stringify-query"],function(t){function r(t){return"[object Object]"===Object.prototype.toString.call(t)}function e(t){return"string"==typeof t
}function n(t,r){if(!Array.isArray(t)||!Array.isArray(r))return!1;if(t.length!==r.length)return!1;t=t.slice(0),t=t.slice(0),t.sort(),r.sort();for(var e=!0,n=0,o=t.length;e&&o>n;n++)e=t[n]==r[n];return e}function o(t,e){if(!r(t)||!r(e))return!1;var o=Object.keys(t),i=Object.keys(e);if(o.length!==i.length)return!1;for(var u,s,a=!0,f=0;a&&(u=o[f]);f++){if(!e.hasOwnProperty(u)){a=!1;break}s=t[u],a=Array.isArray(s)?n(s,e[u]):s==e[u]}return a}function i(t){return t=Array.isArray(t)?t.map(function(t){return decodeURIComponent(t||"")
}):t||e(t)?decodeURIComponent(t):null}function u(t,r,e){var n=e[t];return r=i(r),n?(Array.isArray(n)||(n=[n]),Array.isArray(r)?n=n.concat(r):n.push(r)):n=r,e[t]=n,e}function s(t){t=t||{},c.call(this,t)}var a=t("sfr/router/lang/inherits"),f=t("sfr/router/lang/extend"),c=t("sfr/router/uri/component/Abstract"),p=t("sfr/router/uri/util/parse-query"),h=t("sfr/router/uri/util/stringify-query"),l="?";return a(s,c),s.prototype.set=function(){if(1===arguments.length){var t=arguments[0];if(r(t)){var e=this.data={};
Object.keys(t).forEach(function(r){e[r]=i(t[r])})}else this.data=p(t)}else this.data[arguments[0]]=i(arguments[1])},s.prototype.get=function(t){return t?this.data[t]:f({},this.data)},s.prototype.toString=function(t){t=t||l;var r=h(this.data);return r?t+r:""},s.prototype.equal=function(t){return e(t)?t=p(t):t instanceof s&&(t=t.get()),o(this.data,t)},s.prototype.add=function(t,e){var n=this.data;r(t)?Object.keys(t).forEach(function(r){u(r,t[r],n)}):u(t,e,n),this.data=n},s.prototype.remove=function(t){t?this.data.hasOwnProperty(t)&&delete this.data[t]:this.data={}
},s}),define("sfr/router/uri/component/Scheme",["require","sfr/router/lang/inherits","sfr/router/uri/component/Abstract"],function(t){function r(t){n.call(this,t)}var e=t("sfr/router/lang/inherits"),n=t("sfr/router/uri/component/Abstract");return e(r,n),r.prototype.set=function(t){t=t||"",this.data=t.toLowerCase()},r.prototype.equal=function(t){return t=t instanceof r?t.get():t||"",this.data===t.toLowerCase()},r}),define("sfr/router/uri/component/UserName",["require","sfr/router/lang/inherits","sfr/router/uri/component/Abstract"],function(t){function r(t){n.call(this,t)
}var e=t("sfr/router/lang/inherits"),n=t("sfr/router/uri/component/Abstract");return e(r,n),r}),define("sfr/router/uri/util/parse-query",["require"],function(){function t(t){var r={};t=t.split("&");var e,n;return t.forEach(function(t){t&&(t=t.split("="),e=t[0],n=t.length>=2?decodeURIComponent(t[1]):null,r[e]?(Array.isArray(r[e])||(r[e]=[r[e]]),r[e].push(n)):r[e]=n)}),r}return t}),define("sfr/router/uri/util/stringify-query",["require"],function(){function t(t){var r,e=[];return Object.keys(t).forEach(function(n){r=t[n],Array.isArray(r)||(r=[r]),r.forEach(function(t){e.push(null===t?n:n+"="+encodeURIComponent(t||""))
})}),e.join("&")}return t}),define("sfr/router/uri/util/uri-parser",["require","sfr/router/lang/extend"],function(t){function r(t){var r={},e=["scheme","username","password","host","port","path","query","fragment"];return e.forEach(function(e){r[e]=t[e]||u}),r}function e(t){var r={};return t.replace(/^([^@]+@)?([^:]+)(:\d+)?$/,function(t,e,n,o){e&&(e=e.slice(0,-1),e=e.split(":"),r.username=e[0],r.password=e[1]),r.host=n,o&&(r.port=o.substring(1))}),r}function n(t,r){var n=/[^:]+:\d{2,}(\/|$)/.test(t);
return n&&(t=t.split("/"),s(r,e(t.shift())),t.length>0&&(r.path="/"+t.join("/"))),n}function o(t,r){var e=t.indexOf(":"),n=t.indexOf("/");n=n>=0?n:t.length;var o=e>=0&&n>e;return o&&(r.scheme=t.substring(0,e),r.path=t.substring(e+1)),o}function i(t){var r={},i=t.indexOf("#");return i>=0&&(r.fragment=t.substring(i+1),t=t.substring(0,i)),i=t.indexOf("?"),i>=0&&(r.query=t.substring(i+1),t=t.substring(0,i)),i=t.indexOf("://"),i>=0?(r.scheme=t.substring(0,i),t=t.substring(i+3),"file"===r.scheme?r.path=t:(t=t.split("/"),s(r,e(t.shift())),t.length>0&&(r.path="/"+t.join("/"))),r):n(t,r)?r:o(t,r)?r:(t=t.split("/"),r.host=t.shift(),t.length>0&&(r.path="/"+t.join("/")),r)
}var u,s=t("sfr/router/lang/extend");return function(t){return("string"==typeof t||t instanceof String)&&(t=i(t)),r(t)}}),define("sfr/utils/http",["sfr/utils/promise","sfr/utils/underscore","sfr/utils/url"],function(t,r,e){function n(t){return t instanceof FormData?"multipart/form-data":"application/x-www-form-urlencoded; charset=UTF-8"}function o(e){var n;try{n=u()}catch(o){return t.reject(o)}return n.open(e.method,e.url,!0),r.forOwn(e.headers,function(t,r){n.setRequestHeader(r,t)}),r.assign(n,e.xhrFields),new t(function(t,r){n.onreadystatechange=function(){4==n.readyState&&(n=i(n),n.status>=200&&n.status<300?t(n):r(n))
},n.send(e.data)})}function i(t){var e=t.getAllResponseHeaders().split("\r\n").filter(r.negate(r.isEmpty)).map(function(t){return r.split(t,/\s*:\s*/)});if(t.responseHeaders=r.fromPairs(e),t.data=t.responseText,"application/json"===t.responseHeaders["Content-Type"])try{t.data=JSON.parse(t.responseText)}catch(n){console.warn("Invalid JSON content with Content-Type: application/json")}return t}function u(){var t=!1;if(window.XMLHttpRequest)t=new XMLHttpRequest;else if(window.ActiveXObject)try{t=new ActiveXObject("Microsoft.XMLHTTP")
}catch(r){}if(!t)throw"Cannot create an XHR instance";return t}var s={};return s.ajax=function(t,i){return"object"==typeof t&&(i=t,t=""),i=r.defaultsDeep(i,{url:t,method:i&&i.type||"GET",headers:{},data:null,jsonp:!1,jsonpCallback:"sf_http_"+Math.random().toString(36).substr(2)}),r.forOwn(i.headers,function(t,r){i.headers[r]=t.toLowerCase(t)}),i.headers["content-type"]=i.headers["content-type"]||n(i.data),/application\/json/.test(i.headers["content-type"])?i.data=JSON.stringify(i.data):/form-urlencoded/.test(i.headers["content-type"])&&(i.data=e.param(i.data)),o(i)
},s.get=function(t,r){return s.ajax(t,{data:r})},s.post=function(t,r){return s.ajax(t,{method:"POST",data:r})},s.put=function(t,r){return s.ajax(t,{method:"PUT",data:r})},s.delete=function(t,r){return s.ajax(t,{method:"DELETE",data:r})},s}),define("sfr/utils/di",["require"],function(){var t={},r={container:t};return r.service=function(){},r.factory=function(){},r.provider=function(){},r.value=function(e,n){return Object.defineProperty(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}),r},r}),define("sfr/utils/url",["sfr/utils/underscore"],function(t){function r(r){return t.isObject(r)?t.map(r,function(t,r){return encodeURIComponent(r)+"="+encodeURIComponent(t)
}).join("&"):r}return{param:r}}),define("sfr/utils/underscore",["require"],function(){function t(t){return t=n(t),t.shift(),t}function r(t){return Object.keys(t)}function e(t,r){t=t||{};for(var e in t)if(t.hasOwnProperty(e)&&r(t[e],e,t)===!1)break;return t}function n(t){return t?x.slice.call(t):[]}function o(r){var e=t(arguments);return x.forEach.apply(r||[],e)}function i(r,n){if(p(r)){var o=[];return e(r,function(){o.push(n.apply(null,arguments))}),o}var i=t(arguments);return x.map.apply(r||[],i)
}function u(r){var e=t(arguments);return x.slice.apply(r||[],e)}function s(r){var e=t(arguments);return x.splice.apply(r||[],e)}function a(r){var e=t(arguments);return S.split.apply(r||"",e)}function f(r){return t(arguments).reduce(function(t,r){return t.replace("%s",r)},r)}function c(){return d.apply(null,u(arguments,0).reverse())}function p(t){return null!==t&&"object"==typeof t}function h(t){return t instanceof String||"string"==typeof t}function l(t){return t instanceof RegExp}function d(t){t=null==t?{}:t;
var r=u(arguments,1);return o(r,function(r){m(t,r)}),t}function g(t,r){return t?void e(r,function(r,e){return p(r)&&p(t[e])?g(t[e],r):void(t[e]=r)}):t}function m(t,r){return t?(e(r,function(r,e){t[e]=r}),t):t}function y(){var t={},r=u(arguments,0).reverse();return o(r,function(r){g(t,r)}),t}function v(t){var r={};return i(t,function(t){var e=t[0],n=t[1];r[e]=n}),r}function b(t){return t instanceof Array}function w(t){return b(t)?0===t.length:!t}function q(t){return function(){return!t.apply(null,arguments)
}}function _(t){var r=u(arguments);return function(){var e=[0,0];e.push(r);var n=x.splice.apply(arguments,e);return t.apply(null,n)}}function A(t){var r=u(arguments);return r.shift(),function(){var e=u(arguments),n=[e,arguments.length,0].concat(r);return s.apply(null,n),t.apply(null,e)}}var j={},x=Array.prototype,S=(Object.prototype,String.prototype);return j.keysIn=r,j.forOwn=e,j.assign=d,j.merge=d,j.extend=d,j.defaults=c,j.defaultsDeep=y,j.fromPairs=v,j.slice=u,j.splice=s,j.forEach=o,j.map=i,j.toArray=n,j.split=a,j.format=f,j.isArray=b,j.isEmpty=w,j.isString=h,j.isObject=p,j.isRegExp=l,j.partial=_,j.partialRight=A,j.negate=q,j
}),define("sfr/utils/promise",["require","sfr/utils/underscore"],function(t){function r(t){if(!(this instanceof r))throw"Promise must be called with new operator";if("function"!=typeof t)throw"callback not defined";this._state=n,this._result,this._fulfilledCbs=[],this._rejectedCbs=[];var e=this;setTimeout(function(){e._doResolve(t)})}function e(t){return t&&"function"==typeof t.then}var n=(t("sfr/utils/underscore"),0),o=1,i=2,u={longStackTraces:!1};return r.prototype._fulfill=function(t){this._result=t,this._state=o,this._flush()
},r.prototype._reject=function(t){u.longStackTraces&&t&&(t.stack+="\n"+this._originalStack),this._result=t,this._state=i,this._flush()},r.prototype._resolve=function(t){e(t)?this._doResolve(t.then.bind(t)):this._fulfill(t)},r.prototype._doResolve=function(t){var r=!1,e=this;try{t(function(t){r||(r=!0,e._resolve(t))},function(t){r||(r=!0,e._reject(t))})}catch(n){if(r)return;r=!0,e._reject(n)}},r.prototype._flush=function(){if(this._state!==n){var t=this._state===i?this._rejectedCbs:this._fulfilledCbs,r=this;
t.forEach(function(t){"function"==typeof t&&t(r._result)}),this._rejectedCbs=[],this._fulfilledCbs=[]}},r.prototype._done=function(t,r){this._fulfilledCbs.push(t),this._rejectedCbs.push(r),this._flush()},r.prototype.then=function(t,e){var n,o=this;return new r(function(r,i){o._done(function(e){if("function"==typeof t){try{n=t(e)}catch(o){return i(o)}r(n)}else r(e)},function(t){if("function"==typeof e){try{n=e(t)}catch(o){return i(o)}r(n)}else i(t)})})},r.prototype.catch=function(t){return this.then(function(t){return t
},t)},r.prototype.finally=function(t){return this.then(t,t)},r.resolve=function(t){return e(t)?t:new r(function(r){return r(t)})},r.reject=function(t){return new r(function(r,e){e(t)})},r.all=function(t){return new r(function(e,n){var o=t.map(function(){return void 0}),i=0;t.map(r.resolve).forEach(function(r,u){r.then(function(r){o[u]=r,i++,i===t.length&&e(o)},n)})})},r.mapSeries=function(t,e){var n=r.resolve("init"),o=[];return t.forEach(function(r,i){n=n.then(function(){return e(r,i,t)}).then(function(t){return o.push(t)
})}),n.then(function(){return o})},r}),define("sfr/utils/assert",["require"],function(){function t(t,r){if(!t)throw new Error(r)}return t}),define("sfr/utils/map",["require","sfr/utils/underscore"],function(t){function r(){this.size=0,this._data={}}function e(t){return n.isRegExp(t)?"reg_"+t:n.isString(t)?"str_"+t:"other_"+t}var n=t("sfr/utils/underscore");return r.prototype.set=function(t,r){t=e(t),this._data.hasOwnProperty(t)||(this._data[t]=r,this.size++)},r.prototype.has=function(t){return t=e(t),this._data.hasOwnProperty(t)
},r.prototype.delete=function(t){t=e(t),this._data.hasOwnProperty(t)&&(delete this._data[t],this.size--)},r.prototype.get=function(t){return t=e(t),this._data[t]},r.prototype.clear=function(){this.size=0,this._data={}},r}),define("sfr/action",["require","sfr/router/router","sfr/utils/promise","sfr/utils/assert","sfr/utils/map","sfr/utils/underscore"],function(t){function r(t){return"object"==typeof t&&t.create&&t.attach&&t.detach&&t.destroy&&t.update?!0:!1}function e(){function t(t){return o=t,n=(n+1)%e,i
}function r(){var t=n;return s.mapSeries(o,function(r){return"function"==typeof r&&t===n?r():void 0}).catch(function(t){setTimeout(function(){throw t})})}var e=1e4,n=0,o=[],i={reset:t,exec:r};return i}function n(t,r){var e=r.getAttribute("data-sf-href"),n=r.getAttribute("data-sf-options");if(e){try{n=JSON.parse(n)||{}}catch(o){n={}}n.src="hijack",c.redirect(e,null,n),t.preventDefault()}}function o(t){function r(t,r){for(var e=t;null!==e&&e.tagName!==r.toUpperCase();)e=e.parentNode;return e}document.documentElement.addEventListener("click",function(e){e=e||window.event;
var n=r(e.target||e.srcElement,"A");n&&t(e,n)},!1)}var i,u=t("sfr/router/router"),s=t("sfr/utils/promise"),a=t("sfr/utils/assert"),f=t("sfr/utils/map"),c=(t("sfr/utils/underscore"),{}),p=new f,h=!1,l=e();return c.regist=function(t,e){a(t,"illegal action url"),a(r(e),"illegal service, make sure to extend from sfr/service"),a(!p.has(t),"path already registerd"),u.add(t,this.dispatch),p.set(t,e)},c.dispatch=function(t,r){var e=p.get(t.pathPattern),n=p.get(r.pathPattern);return t.options=t.options||{},h&&(t.options.src="back",h=!1),l.reset([n&&n.detach.bind(n,t,r),e&&e.create.bind(e,t,r),r.url!==i&&n&&n.destroy.bind(n,t,r),e&&e.attach.bind(e,t,r)]).exec()
},c.remove=function(t){return p.delete(t)},c.exist=function(t){return p.has(t)},c.clear=function(){p.clear(),u.clear()},c.redirect=function(t,r,e){u.redirect(t,r,e)},c.back=function(){h=!0,history.back()},c.reset=function(t,r,e){u.reset(t,r,e)},c.start=function(){o(n)},c.update=function(t,r,e,n){e=e?e:{},e.hasOwnProperty("silent")||(e.silent=!0);var o=location.href.replace(/.*\/([^\/]+$)/,"/$1"),i=location.pathname.replace(/.*\/([^\/]+$)/,"/$1");if(p.has(i)){var s=p.get(i);s.update({path:i,url:t,prevUrl:o,query:r,options:e,extend:n})
}u.reset(t,r,e)},c}),define("sfr/service",["require"],function(){var t=function(){};return t.prototype.create=function(){},t.prototype.attach=function(){},t.prototype.detach=function(){},t.prototype.destroy=function(){},t.prototype.update=function(){},t}),define("sfr/resource",["sfr/utils/http","sfr/utils/underscore"],function(t,r){function e(t){this.url=t}return e.prototype={getUrl:function(t){var e=this.url;return r.forOwn(t,function(t,r){e=e.replace(":"+r,t)}),e=e.replace(/:\w+/g,"")},create:function(r,e){var n=this.getUrl(e);
return t.post(n,r)},query:function(r){var e=this.getUrl(r);return t.get(e)},update:function(r,e){var n=this.getUrl(e);return t.put(n,r)},"delete":function(r){var e=this.getUrl(r);return t.delete(e)}},e}),define("sfr/view",["require"],function(){var t=function(){this._init()};return t.prototype={_init:function(){},set:function(){},get:function(){},create:function(){},render:function(){},update:function(){},attach:function(){},detach:function(){},destroy:function(){},on:function(){},off:function(){}},t
}),!function(){var t=[{name:"action",mid:"sfr/action"},{name:"router",mid:"sfr/router/router"},{name:"view",mid:"sfr/view"},{name:"service",mid:"sfr/service"},{name:"resource",mid:"sfr/resource"},{name:"http",mid:"sfr/utils/http"},{name:"promise",mid:"sfr/utils/promise"}],r=t.map(function(t){return t.mid});r.push("sfr/utils/di"),define("sfr",r,function(){var r=require("sfr/utils/di");return t.forEach(function(t){r.value(t.name,require(t.mid))}),r.container})}();