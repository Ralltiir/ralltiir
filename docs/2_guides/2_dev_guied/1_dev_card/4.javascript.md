# js 开发文档规范

> qijian,2016-06-16

## 一、使用方式

在模板中统一使用

```
/* card.setup 可传入 {object}，此时传入的 object 会被当做数据处理 */
card.setup({
    text1: 'value',
    text2: 'value'
});

/* 当传入 function，会在页面初始化后执行
card.setup(function () {
    /* this 是当前模板的实例，不管模板有几个 function，this 都是同一个 */
    var self = this;

    var timeout = setTimeout(function () {
        console.log(123);
    }, 3000);

    /* 当有异步、全局变量、timeout、interval 等，都需要实现 destroy，在destroy中清除 */
    this.destroy = function () {
        clearTimeout(timeout);
    };
});
```

## 二、外链JS

1、统一使用 AMD 方式引入

```
card.setup(function () {
    require(['sf/card/[模板名]/[文件名]'], function () {

    });
});
```

2、文件位置

svn: src/static/sf/card/[模板名]/[文件名]

平台: 静态资源/sf/card/[模板名]/[文件名]


3、模块ID

不能使用 define('xxxid', function () {});  的方式定义模块ID。

请直接使用 define(function () {}); 

fis 编译时会自动生成模块ID


## 三、JS文件内嵌

参见 [fis文档](http://fis.baidu.com/fis3/docs/user-dev/inline.html)


## 四、JS接口

```
// 生成 tc 链接
card.setup({
   _tcUrl: '{%fe_fn_card_tc_url%}'
});

card.setup(function () {
    var url = this.makeTcUrl({
        src: 'http://m.baidu.com/xxx',
        di: xxx,
        sec: xxx
    });

    // 或者
    var url = this.makeTcUrl({
        nsrc: '加密串'
    });
});
```

### di 和 sec 参数说明

di 和 sec 是两个加密串，如果百度内部的跳转链接，如跳转到 image.baidu.com，可暂时不用这两个参数。
其它第三方链接必须要加 di 和 sec。如果跳转链接来自 http://opendata.baidu.com/api.php，可以在接口中传入 need_di=1，数据中会自动加上相关字段。
如：http://opendata.baidu.com/api.php?resource_id=14830&query=NBA&need_di=1&tn=wisexmlnew&co=vslist%5Bdate%3D05%E6%9C%8818%E6%97%A5%5D&dsp=iphone&_=1463479966606&cb=jsonp1
加了 need_di 后，原始数据中多了 url_di、sec 等等参数。
其它接口返回的参数需要接口支持生成 di 和 sec。具体生成规则可以联系 @贾晨辉
